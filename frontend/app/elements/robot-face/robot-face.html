<link rel="import" href="../../bower_components/polymer/polymer.html">
<!-- I think I don't need to import all these Polymer elements but I did anyway. -->
<link rel="import" href="../bower_components/paper-slider/paper-slider.html">
 <link rel="import" href="../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">

<dom-module id="robot-face">
  <template>
    <style>
      :host {
        display: block;
        width: 100%;
        height: 100%;
        background-color: #512DA8; /*#512DA8*/
        position: fixed;
        font-family: 'Roboto', sans-serif;
      }
      #face {
        width: 100%;
        margin: auto;
				height: 90%; /* height is 90% so it doesn't cover button, this isn't ideal*/
        /* original ... height: 120px;*/
        /* original ... position: fixed; */
				position: absolute;
        bottom: 0;
      }

      robot-eye {
        width: 100px;
				position: absolute;
				bottom: 15px;
				margin: auto;
      }

      #rightEye {
				right: 15px;
      }

      #leftEye {
				left: 15px;
      }

      #faceContent {
        max-height: 390px;
        overflow: auto;
      }

 
/*This button toggles the drawer-panel.  right:0px aligns the button right; 
position:absolute keeps it relative to the main panel (I think.)
TODO: Is there a way to put the button on top of the face so the face can be 100% height?*/
      #drawerButton {
				color: #000;
				width: 50px;
				height: 20px;
				position: absolute;
				right: 0px;
      }

/* normally, paper-buttons are purple. */
      paper-button {
				background-color: #512DA8;
      }

/* when active (clicked), paper-buttons are blue. */
      paper-button[active] {
				background-color: blue;
				font-color: 
      }

      #faceContent > ::content robot-message + robot-message {
        margin-top: 30px;
      }
    </style>
<!-- adding paper-drawer-panel as a menu, will put slider in it. force-narrow attribute makes the panel always in narrow layout, so the panel can be dragged over the main panel.-->
    <paper-drawer-panel id="panel" force-narrow="true" >
	<div id="editDrawer" drawer on-iron-deselect="exitEdit">
		<robot-menu id="editMenu"> </robot-menu>
	</div>
	<div main> 
		<!-- this button toggles editing mode.-->
		<paper-button id="drawerButton" toggles on-tap="toggleMode">EDIT</paper-button>
		<div id="faceContent">
      			<content></content>
    		</div>
		<!-- the face layout. removed editFace, put color selector always in editor-->
    		<div id="face" class="layout horizontal">
      			<robot-eye id="leftEye" on-tap="openEyeMenu"></robot-eye>
      			<div class="flex"></div>
      			<robot-mouth id="mouth" on-tap="openMouthMenu"></robot-mouth>
      			<div class="flex"></div>
      			<robot-eye id="rightEye" on-tap="openEyeMenu"></robot-eye>
    		</div>
    	</div>
	</div>
    </paper-drawer-panel>
    
  </template>
  <script>
  (function() {
    'use strict';
    Polymer({
      is: 'robot-face',

      properties: {

      },

			ready: function() {
				this.$.editMenu.getFace(this);
			},

      blinkRandomly: function() {  // called in ready(), blinks at random intervals
        var nextBlink = Math.random() * 3000 + 2500;
        var that = this;
        setTimeout(function() { that.blink(); that.blinkRandomly(); }, nextBlink);
      },

      toggleMode: function() { // sets the menu openable when toggle button is pressed, and vv.
				var panel = this.$.panel;
				if(this.$.drawerButton.active){
					panel.disableSwipe = false;
					panel.disableEdgeSwipe = false;
				}else {
					this.$.panel.disableEdgeSwipe = true;
					this.$.panel.disableSwipe = true;
        }
      },

      exitEdit: function(){ // not currently called.
				this.$.drawerButton.active = false;
      },

      blink: function() {
				this.$.leftEye.blink();
        this.$.rightEye.blink();
      },

      openEyeMenu: function() {  
				//open menu when eye clicked in edit mode, blink when clicked in non-edit mode.
				if(this.$.drawerButton.active){
					this.$.panel.openDrawer();
					this.$.editMenu.setPage(0);
				} else{
					this.blink();
				}
      },

      openMouthMenu: function() {
				//open mouth page in menu when mouth tapped in edit mode
				// TODO unibrow area also registers as mouth (????)
				if(this.$.drawerButton.active){
					this.$.panel.openDrawer();
					this.$.editMenu.setPage(1);
				}
      },

			editEye: function(params){
				this.$.rightEye.edit(params);
				this.$.leftEye.edit(params);
			},

			editMouth: function(params){
				this.$.mouth.edit(params);
			}

	/*
	* open face page in menu when face (not eye or mouth) clicked in edit mode
	* features also open 2.  maybe being changed to 2, 
	* editFace called just after editEye bc editMode isnt turned off immed. anymore?
	* not bc eye part of face.
	* but when iron-deselect is in drawer div, it doesnt tap eye even though
	* it does deselect button right away.
	*/

    });
  })();
  </script>
</dom-module>
