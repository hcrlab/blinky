<!-- TODO the eye and the mouth menus close editing mode when deslected, but eyebrow doesn't ... ??? -->
<!-- the edit button gets deselcted when a component is clicked for the first time in edit mode, but if you close the menu -->
<!-- and select the edit button again and click that same component it does not deselct that time. -->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="robot-face">
  <template>
    <style>
      :host {
        display: block;
        width: 100%;
        height: 100%;
        position: fixed;
        font-family: 'Roboto', sans-serif;
      }
      #face {
        width: 100%;
        margin: auto;
				height: 90%; /* height is 90% so it doesn't cover button, this isn't ideal*/
        /* original ... height: 120px;*/
        /* original ... position: fixed; */
				position: absolute;
        bottom: 0;
      }
		
			robot-eyebrow{
				height: 50px;
				width: 150px;
				margin: auto;
				top: 200px;
				position: relative;
			}

			#leftEyebrow{
				left:15px;
			}

			#rightEyebrow{
				right: 15px;
			}

      robot-eye {
				/*TODO anything other than 150px h gets all messed up bc height of eye is always full height of page or something?.*/
				position: absolute;
				margin: auto;
				height: 150px;
				width: 150px;
				bottom: 0px;
      }

      #rightEye {
				right: 15px;
      }

      #leftEye {
				left: 15px;
      }

			robot-mouth{
				position: absolute;
				bottom: 0;
			}

      #faceContent {
        /*max-height: 390px;*/
        overflow: auto;
      }

 
/*This button toggles edit mode.
TODO: Is there a way to put the button on top of the face so the face can be 100% height?*/
      #drawerButton {
				color: #000;
				width: 50px;
				height: 20px;
				position: absolute;
				right: 0px;
      }

/* when active (clicked), paper-buttons are blue. */
      paper-button[active] {
				background-color: blue;
      }

      #faceContent > ::content robot-message + robot-message {
        margin-top: 30px;
      }
    </style>
<!-- adding paper-drawer-panel as a menu, will put slider in it. force-narrow attribute makes the panel always in narrow layout, so the panel can be dragged over the main panel.-->
    <paper-drawer-panel id="panel" force-narrow="true" >
	<div id="editDrawer" drawer on-iron-deselect="exitEdit">
		<robot-menu id="editMenu" config="{{config}}" eye-y="{{eyeY}}" eye-h="{{eyeH}}" eye-w="{{eyeW}}"> </robot-menu>
	</div>
	<div main> 
		<!-- this button toggles editing mode.-->
		<paper-button id="drawerButton" toggles on-tap="toggleMode" color$="{{config.faceColor}}">EDIT</paper-button>
		<div id="faceContent">
      			<content></content>
    		</div>
		<!-- the face layout. removed editFace, put color selector always in editor-->
    		<div id="face" class="layout horizontal">
						<!-- TODO the eyebrows aren't positioned relative to the eye. -->
						<div height="170px">
      				<robot-eye id="leftEye" on-tap="openEyeMenu" config="{{config}}" style$="bottom: {{eyeY}}; height:{{eyeH}}; width:{{eyeW}}"></robot-eye>
							<robot-eyebrow id="leftEyebrow" on-tap="openEyebrowMenu" config="{{config}}"></robot-eyebrow>
						</div>
      			<div class="flex"></div>
						<!--TODO mouth isn't in between flexboxes, might not be centered?-->
      			<robot-mouth id="mouth" on-tap="openMouthMenu" ></robot-mouth>
      			<div class="flex"></div>
						<div height="170px">
      				<robot-eye id="rightEye" on-tap="openEyeMenu" config="{{config}}" style$="bottom: {{eyeY}}; height:{{eyeH}}; width:{{eyeW}}"></robot-eye>
							<robot-eyebrow id="rightEyebrow" on-tap="openEyebrowMenu" config="{{config}}"></robot-eyebrow>
						</div>
    		</div>
    	</div>
	</div>
    </paper-drawer-panel>
    
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'robot-face',

      properties: {
				config: {
					type: Object,
					notify: true,
					value: function() {
						return{
							eyeColor: '#009933',
							menuPage: 0,
							faceColor: '#512DA8'
						};
					}
				},
				//these are separate from config so they are easier to set in style attribute.
				eyeH: '150px',
				eyeW: '150px',
				eyeY: {value:'15px'}
      },

			ready: function() {
				this.$.editMenu.getFace(this);
				this.$.panel.disableSwipe = true;
				this.blinkRandomly();
			},

      blinkRandomly: function() {  // called in ready(), blinks at random intervals
        var nextBlink = Math.random() * 3000 + 2500;
        var that = this;
        setTimeout(function() { that.blink(); that.blinkRandomly(); }, nextBlink);
      },

      toggleMode: function() { // sets the menu openable when toggle button is pressed, and vv.
				var panel = this.$.panel;
				if(this.$.drawerButton.active){
					panel.disableEdgeSwipe = false;
				}else {
					this.$.panel.disableEdgeSwipe = true;
        }
      },

      exitEdit: function(){ // not currently called.
				this.$.drawerButton.active = false;
      },

      blink: function() {
				this.$.leftEye.blink();
        this.$.rightEye.blink();
      },

      openEyeMenu: function() {  
				//open menu when eye clicked in edit mode, blink when clicked in non-edit mode.
				if(this.$.drawerButton.active){
					this.$.panel.openDrawer();
					this.$.editMenu.setPage(0);
				} else{
					this.blink();
				}
      },

			openEyebrowMenu: function(){
				if(this.$.drawerButton.active){
					this.$.panel.openDrawer();
					this.$.editMenu.setPage(3);
				}
			},

      openMouthMenu: function() {
				//open mouth page in menu when mouth tapped in edit mode
				if(this.$.drawerButton.active){
					this.$.panel.openDrawer();
					this.$.editMenu.setPage(1);
				}
      },

			// handles edits that need to happen in robot-eye, eg color.
			editEye: function(params){
				this.$.rightEye.edit(params);
				this.$.leftEye.edit(params);
			},

			// handles edits that need to happen in robot-mouth, eg color.
			editMouth: function(params){
				this.$.mouth.edit(params);
			},

			// handles edits to eye position and size.
			moveEye: function(height, width){
				if(height !== null){
					this.$.leftEye.style.height = height;
					this.$.rightEye.style.height = height;					
				}
				if(width !== null){
					this.$.leftEye.style.width = width;
					this.$.rightEye.style.width = width;
				}

			}

    });
  })();
  </script>
</dom-module>
